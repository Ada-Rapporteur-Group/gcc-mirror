2011-10-18  Nenad Vukicevic <nenad@intrepid.com>

	Fix support for large file support on 32-bit machines.

	* smp/upc_config.h: Move inclusion of 'config.h' to the top
	  of the include list. This allows all system include files
	  to see definition of _FILE_OFFSET_BITS=64 that enables large
	  file support.

2011-10-02  Gary Funck  <gary@intrepid.com>

	Move the collectives library sources into their own directory
	and add support for additional runtime implementation models.
	* collectives/gen-upc-coll-reduce.pl: Moved from 'smp' directory.
	* collectives/upc_coll_broadcast.upc: Ditto.
	* collectives/upc_coll_err.upc: Ditto.
	* collectives/upc_coll_exchange.upc: Ditto.
	* collectives/upc_coll_gather_all.upc: Ditto.
	* collectives/upc_coll_gather.upc: Ditto.
	* collectives/upc_coll.h: Ditto.
	* collectives/upc_coll_init.upc: Ditto.
	* collectives/upc_coll_permute.upc: Ditto.
	* collectives/upc_coll_prefix_reduce.in: Ditto.
	* collectives/upc_coll_prefix_reduce.upc: Ditto.
	* collectives/upc_coll_readme.txt: Ditto.
	* collectives/upc_coll_reduce.in: Ditto.
	* collectives/upc_coll_reduce.upc: Ditto.
	* collectives/upc_coll_scatter.upc: Ditto.
	* collectives/upc_coll_sort.upc: Ditto.
	* smp/gcc-upc-lib.in: Moved from 'include' directory.
	* gen-gccupc-inline-lib.pl: Moved from 'smp' directory.
	* gen-gccupc-ld-script.pl: Ditto.
	* configure.ac: Implement support for additional runtime
	models. (Currently, only 'smp' is supported.)
	Build the collectives library from sources in the
	collectives directory.
	* Makefile.am: Likewise.
	* configure: Re-generate.
	* config.h.in: Re-generate.
	* Makefile.in: Re-generate.

2011-09-30  Gary Funck  <gary@intrepid.com>

	Generalize collectives library to support indefinite block sizes.
	* smp/upc_coll_prefix_reduce.in: If 'blk_size' is zero, then set it
	to 'nelems'.
	* smp/upc_coll_reduce.in: Ditto.
	* smp/upc_coll_prefix_reduce.upc: Re-generate.
	* smp/upc_coll_reduce.upc: Re-generate.

2011-09-19  Gary Funck  <gary@intrepid.com>

	* libupc/smp/upc_access.c (__getstf2, __getsxf2):
	Define temporary as "long double" rather than "double" to avoid
	loss of precision.
	* testsuite/libupc.upc/intrepid/test29.upc: Improve the test of
	"long double" by adding checks that required accuracy
	exceeds the accuracy of "double".

2011-09-02  Gary Funck  <gary@intrepid.com>

	Align UPC pointers-to-shared, only if the target enforces
	strict alignment.
	* configure.ac: Derive GUPCR_PTS_ALIGN from __UPC_PTS_ALIGN__,
	  if present.  Define GUPCR_PTS_ALIGN as a config.h variable.
	* smp/upc_pts.h (GUPCR_PTS_ALIGN): Use only if defined.
	* config.h.in: Re-generate.
	* configure: Re-generate.

2011-08-23  Nenad Vukicevic <nenad@intrepid.com>

	* configure.ac: Enable detection of large file support on
	  32-bit machines.
	* configure: Re-generate.
	* config.h.in: Added define for large file support on 32-bit
	  machines.
	* smp/upc_config.h: Limit number of VM pages to the number
	  of configured VADDR bits.
	* smp/upc_sup.h: Prototype change.
	* smp/upc_vm.c (__upc_vm_alloc): Return an error if no
	  more virtual pages can be allocated.
	  (__upc_vm_alloc): Abort if initial number of VM pages cannot
	  be allocated.
	  (__upc_vm_get_cur_page_alloc): Check for error before NUMA
	  memory region mapping.
	* smp/upc_alloc.upc (__upc_global_heap_alloc): Return NULL pointer
	  if VM pages cannot be allocated.
	  (__upc_local_alloc): Return NULL pointer if memory is not available.

2011-08-16  Gary Funck  <gary@intrepid.com>

	* smp/upc_barrier.c (__upc_notify, __upc_wait):
	  Improve error messages.

2011-08-10  Gary Funck  <gary@intrepid.com>

	Define UPCFLAGS so that it is available in the Makefile,
	and assign CFLAGS as its default value.

	* configure.ac (UPCFLAGS): Default to CFLAGS if not set.
	  (UPCFLAGS): Make it an AC_SUBST() so that it can
	  be referenced in the Makefile.
	* Makefile.am (AM_UPCFLAGS): Make sure that it is update
	  the same as AM_CFLAGS.
	* configure, Makefile.in: Re-generate.

2011-06-06  Nenad Vukicevic <nenad@intrepid.com>

	* smp/upc_config.h: Change default scheduling policy.
	  Allow the kernel to schedule UPC threads on its own.

2011-05-17  Gary Funck  <gary@intrepid.com>

	* configure.ac (GUPCR_PTS_VADDR_FIELD,
	  Delete unused definitions.
	  configure: Regenerate.

	* smp/upc_pts.h (GUPCR_PTS_THREAD_FIELD,
	  GUPCR_PTS_PHASE_FIELD): Delete unused definitions
	  and references.

	* config.h.in (GUPCR_PTS_THREAD_FIELD,
	  GUPCR_PTS_PHASE_FIELD): Delete unused definitions
	  and references.
 
 	* upc-crtstuff.c: Delete include of "upc-conf.h".

2011-05-03  Gary Funck  <gary@intrepid.com>

	* smp/upc_alloc.upc (__upc_global_heap_alloc,
	  upc_free): Remove extraneous FIXME/TODO comments.

2011-05-01  Gary Funck  <gary@intrepid.com>

	* configure.ac (upc_crtstuff_mak): New AC_SUBST variable.
	* configure.tgt (upc_crtstuff_mak): Find upc-crtstuff.mak
	  on $config_path.
	* Makefile.am (upc_crtstuff_mak): Set make variable to value
	  of configured AC_SUBST value.  This eliminates an automake
	  error caused by a nested 'if' statement.
	* configure, Makefile.in, testsuite/Makefile.in: Regenerate.

2011-04-13  Gary Funck  <gary@intrepid.com>

	* testsuite/lib/libupc.exp (ALWAYS_CFLAGS):
	  Remove -lupc from required default switches.
	  The appropriate library is selected by the
	  libupc.spec file.

2011-03-22  Gary Funck  <gary@intrepid.com>

	* configure.tgt: Move linker switches into libupc.spec.

2011-03-20  Gary Funck  <gary@intrepid.com>

	Place error message strings directly into the calls to
	__upc_fatal(), rather than listing them separately
	as #define's.  The intent of this change is to make
	it easier to internationalize the message text
	using standard tools.

	* include/gcc-upc-lib.in: Remove include of lib_config_msgs
	  named code segment.

	* smp/upc_config.h: Remove #define's used to provide named
	  references to error messages.

	* smp/upc_lock.c, smp/upc_numa.c, smp/upc_access.c,
	  smp/upc_vm.c, smp/upc_main.c, smp/upc_alloc.upc,
	  smp/upc_sysdep.c, smp/upc_affinity.c, smp/upc_addr.c,
	  smp/upc_mem.h, smp/upc_barrier.c: Replace named references
	  with actual error message text strings.

2011-03-20  Gary Funck  <gary@intrepid.com>

	Move UPC start files, end files, and linker specs.
	into libupc.  This reduces the impact on common GCC
	configuration files, and ensures that these UPC-specific
	components are only built when the UPC language dialect is built.

	* upc-crtstuff.c: New file. Moved from gcc/upc/upc-crtstuff.c.

	* config/darwin/upc-crt-config.h: New file. Move defines for
	  UPC-related section begins/ends from gcc/config/darwin.h to here.

	* config/default/upc-crt-config.h: New file. Move defines for
	  UPC-related section begins/ends from gcc/config/upc-conf.h to here.

	* config/default/upc-crtstuff.mak: New file. Default makefile fragment for
	  building the upc-crtbegin and upc-crtend object files.
	  This logic was moved from libgcc/Makefile.in to here.

	* config.h.in: Regenerate with autoheader.  Rename HAVE_GUM_DEBUG
	  to GUPCR_HAVE_GUM_DEBUG.  Add define for HAVE_UPC_LINK_SCRIPT.

	* configure.ac, configure: Include new configure.tgt script
	  towards the end of the logic that configures the smp runtime.
	  Define substitutions for 'config_path', 'XCFLAGS',
	  'XLDFLAGS', 'link_upc_spec', 'upc_crtbegin_spec',
	  'upc_crtend_spec', 'upc_crtstuff_objs'. Add LIBUPC_CRTSTUFF
	  automake conditional.  Fix copyright date in AM_TOP() comment.
	  Define upc-crtbegin.spec libupc.spec upc-crtend.spec as
	  autoconf generated config. files.  Regenerate 'configure'.

	* configure.tgt: New. Target-specific configuration logic.
	  Defines 'config_path', 'upc_crtstuff', 'upc_crtbegin_spec',
	  'upc_crtend_spec', 'upc_crtstuff_objs' variables; these are used
	  to control the build of the UPC-related begin/end files
	  and associated target-specific compiler specification files.

	* libupc.spec.in, upc-crtbegin.spec.in, upc-crtend.spec.in: New.
	  Define target-specific compiler specifications for linking
	  and for inclusion of UPC-related start/end object files
	  when a UPC program is linked.  These files are used
	  to create resulting .spec files that are included via
	  GCC's link spec. when a UPC program is linked.

	* Makefile.am: Add rules to build and install upc-crtbegin.spec,
	  libupc.spec, and upc-crtend.spec from there .in files.
	  Add rules to build the UPC-specific start/end files if the
	  automake conditional LIBUPC_CRTSTUFF is enabled.
	  Fix references to make variables $(UPC_COLL_PREFIX_REDUCE_UPC)
	  and $(UPC_COLL_REDUCE_UPC) in MAINTAINER_MODE block.

        * Makefile.in, testsuite/Makefile.in: Regenerate with automake.
	  
	* smp/Make-defs, smp/Make-deps, smp/Make-rules: Remove.
	  These Makefile fragments have not been used since libupc
	  was re-worked to use automake (when the gupc branch
	  was first checked in).

	* smp/upc_config.h: Move the defintions of GUPCR_INIT_ARRAY_START
	  and GUPCR_INIT_ARRAY_END from smp/upc_main.c to here.

	* smp/upc_main.c: Rename HAVE_GUM_DEBUG to GUPCR_HAVE_GUM_DEBUG.
	  Move the defintions of GUPCR_INIT_ARRAY_START and
	  GUPCR_INIT_ARRAY_END to smp/upc_config.h.

2011-02-22  Gary Funck  <gary@intrepid.com>

	* include/gcc-upc.h (barrier, barrier_notify, barrier_wait,
	  forall, fence): Remove #define's that renamed these deprecated
	UPC keywords into their equivalents in the current UPC
	language specification.

2011-02-08  Gary Funck  <gary@intrepid.com>

	* acinclude.m4, configure.ac, include/gasp.h,
	  include/gasp_upc.h, include/gcc-upc.h, include/gcc-upc-lib.in,
	  include/pupc.h, include/upc_collective.h, include/upc.h,
	  include/upc_relaxed.h, include/upc_strict.h, libupc.texi,
	  smp/upc_access.c, smp/upc_accessg.c, smp/upc_access.h,
	  smp/upc_addr.c, smp/upc_affinity.c, smp/upc_affinity.h,
	  smp/upc_affinity_stub.c, smp/upc_allocg.upc,
	  smp/upc_alloc.upc, smp/upc_barrier.c, smp/upc_config.h,
	  smp/upc_debug.h, smp/upc_defs.h, smp/upc_gasp.c, smp/upc_gum.c,
	  smp/upc_libg.c, smp/upc_lib.h, smp/upc_lock.c, smp/upc_main.c,
	  smp/upc_mem.c, smp/upc_mem.h, smp/upc_numa.c, smp/upc_numa.h,
	  smp/upc_numa_stub.c, smp/upc_pgm_info.c, smp/upc_pts.h,
	  smp/upc_pupc.c, smp/upc_pupc.h, smp/upc_sup.h, smp/upc_sync.h,
	  smp/upc_sysdep.c, smp/upc_sysdep.h, smp/upc_vm.c:
	Update copyright notices.

2010-10-18  Gary Funck  <gary@intrepid.com>

	* smp/upc_alloc.upc: upc_alloc.upc: remove pointer arithmetic on
	  (shared void *) types.

	  Now that GCC/UPC prohibits arithmetic on "(shared void *)" types,
	  re-work the logic in upc_alloc.upc to avoid operating directly on
	  "(shared void *)" type.

2010-10-16  Gary Funck  <gary@intrepid.com>

	* smp/upc_main.c: Fix comment format.

2010-10-16  Gary Funck  <gary@intrepid.com>

	* smp/: upc_access.c, upc_access.h, upc_accessg.c: Implement fixes
	  for SGI/IRIX/MIPS port.

	  The gcc/Makefile.in rules for install-plugin had to be re-written to
	  break up a long list of header files that exceeded the command line
	  limitation imposed by Irix.

	  Access functions for TFmode types had to be implemented.
	  Apparently, this is the mode used for the SGI/MIPS port to represent
	  "long float".

	  See also: gcc/Makefile.in libupc/smp/upc_access.c
	  libupc/smp/upc_access.h libupc/smp/upc_accessg.c

2010-10-16  Nenad Vukicevic  <nenad@intrepid.com>

	* include/gcc-upc.h, smp/upc_main.c: Fix rand() implementation for
	  pthreads run-time.

	  For the pthreads implementation we keep a per-thread random seed
	  number.  This way, calls to rand() function will return the same
	  value on each thread.

	  rand() and srand() functions are redefined as __upc_random and
	  __upc_srandom.

2010-10-10  Gary Funck  <gary@intrepid.com>

	* include/upc_collective.h, smp/gen-upc-coll-reduce.pl,
	  smp/upc_coll_prefix_reduce.upc, smp/upc_coll_reduce.upc:
	  Implement collectives on "long double" objects.

	  See also: libupc/include/upc_collective.h
	  libupc/smp/gen-upc-coll-reduce.pl
	  libupc/smp/upc_coll_prefix_reduce.upc libupc/smp/upc_coll_reduce.upc

2010-10-09  Gary Funck  <gary@intrepid.com>

	* smp/: upc_access.c, upc_access.h, upc_accessg.c: Implement shared
	  access to "long float" data type.

	  See also: libupc/smp/upc_access.c libupc/smp/upc_access.h
	  libupc/smp/upc_accessg.c

2010-09-24  Gary Funck  <gary@intrepid.com>

	* smp/upc_main.c: Fix bug: Failure to initialize per-thread
	  static variables that refer to shared addresses.

	  The shared data initialization routine created by the compiler needs
	  to be called on each threead, because in some cases it will
	  initialize per thread data.  At the moment, the compiler does not
	  generate code that will differentiate between initialization code
	  that should only occur on thread 0, so some additional work may get
	  done.  In the future, that aspect of initialization will be
	  corrected.

2010-09-22  Gary Funck  <gary@intrepid.com>

	* include/gcc-upc-lib.in, include/upc.h, smp/upc_main.c:
	  Fix bug: Nested upc_forall() semantics are not implemented

	  The checkforall test in the Berkeley harness test suite indicated
	  that GCC/UPC was not properly implementing nested upc_forall
	  semantics.  Nested upc_forall statements (both statically or
	  dynamically nested) must implement their affinity clause as if it
	  were "continue"; thus all steps in the loop must execute without
	  regard for affinity.  To implement these semantics a global depth
	  counter, __upc_forall_depth, is maintained by the generated code
	  that implements upc_forall.

	  See also: gcc/c-parser.c gcc/c-tree.h gcc/stub-upc.c
	  gcc/upc/upc-act.c gcc/upc/upc-act.h libupc/include/gcc-upc-lib.in
	  libupc/include/upc.h libupc/smp/upc_main.c

2010-09-18  Gary Funck  <gary@intrepid.com>

	* Makefile.in, config.h.in, configure, configure.ac, include/upc.h,
	  smp/Make-defs, smp/upc_accessg.c, smp/upc_allocg.upc,
	  smp/upc_defs.h, smp/upc_libg.c, smp/upc_main.c, smp/upc_sup.h:
	  Implement -fupc-debug switch.

2010-02-28  Gary Funck  <gary@intrepid.com>

	Initial implementation and checkin.

