#!/bin/sh
set -e

url=https://ftp.gnu.org/gnu/bison/bison-3.8.2.tar.gz

# This script downloads and builds bison 3.8.2. It relies on the
# following variable and default value:
#
# srcdir	$HOME/projects/bison	where to put the bison source tree
#
# The user may also set two other variables:
#
# configure	any set of options, such as --prefix=<foo>, to be passed
#		to the configure script
# sudo		any string (often "sudo") to prefix "make install", in case the
#		the account building bison does not have rights to install it 

srcdir=${srcdir:-$HOME/projects/bison}

mkdir -p $srcdir
cd $srcdir
test -f $(basename $url)  ||
    curl -o $(basename $url) $url
test -f $(basename $url .gz) ||
    tar -x -f $(basename $url)

cd $(basename $url .tar.gz)
mkdir -p build
cd       build

echo configuring bison ...
../configure $configure > log

make -s 
make -s install || {
    if [ "$sudo" ]
    then
        echo "retrying install with: $sudo make -s install"
        $sudo make -s install
    else
        false
    fi
}
bison --version 

echo "Note: bison source tree was extracted in $srcdir"

