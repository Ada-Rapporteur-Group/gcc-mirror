# Copyright (C) 2017 Free Software Foundation, Inc.
#
# This file is part of GCC.
#
# GCC is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3, or (at your option)
# any later version.
#
# GCC is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with GCC; see the file COPYING3.  If not see
# <http://www.gnu.org/licenses/>.

# Enable building IBM extended double multilib on a system that defaults to
# IEEE 128-bit floating point
MULTILIB_OPTIONS	+= mabi=ibmlongdouble
MULTILIB_DIRNAMES	+= ibm128

# Symlink crt{1,i,n}
GCC_PASSES		+= ibm-crts

# The CRT files don't care whether long double is IBM extended double or IEEE
# 128-bit, so use the same crt*.o files for -mabi=ibmlongdouble
ibm-crts: xgcc$(exeext)
	mkdir -p ibm128; \
	for x in crt1.o crti.o crtn.o; do \
		b=`./xgcc$(exeext) -B./ --print-file-name $$x`; \
		if [ x$$b != x$$x ]; then \
			rm -f ibm128/$$x; \
			ln -s $$b ibm128/$$x; \
			echo "Create ibm128/$$x link"; \
		fi; \
	done; \
	touch ibm-crts

