# Copyright (C) 2017 Free Software Foundation, Inc.
#
# This file is part of GCC.
#
# GCC is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3, or (at your option)
# any later version.
#
# GCC is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with GCC; see the file COPYING3.  If not see
# <http://www.gnu.org/licenses/>.

# Enable building IEEE 128-bit floating point multilibs on a system that
# defaults to IBM extended double floating point.
MULTILIB_OPTIONS	+= mabi=ieeelongdouble
MULTILIB_DIRNAMES	+= ieee128

# Symlink crt{1,i,n}
GCC_PASSES		+= ieee-crts

# The CRT files don't care whether long double is IBM extended double or IEEE
# 128-bit, so use the same crt*.o files for -mabi=ieeelongdouble
ieee-crts: xgcc$(exeext)
	@mkdir -p ieee128; \
	for x in crt1.o crti.o crtn.o; do \
		b=`./xgcc$(exeext) -B./ --print-file-name $$x`; \
		if [ x$$b != x$$x ]; then \
			rm -f ieee128/$$x; \
			ln -s $$b ieee128/$$x; \
			echo "Create ieee128/$$x and ./$$x links"; \
			rm -f ./$$x; \
			ln -s $$b ./$$x; \
		else \
			b=`$CC --print-file-name $$x`; \
			if [ x$$b != x$$x ]; then \
				rm -f ieee128/$$x; \
				ln -s $$b ieee128/$$x; \
				echo "Create ieee128/$$x and ./$$x links"; \
				rm -f ./$$x; \
				ln -s $$b ./$$x; \
			fi; \
		fi; \
	done; \
	touch ieee-crts


