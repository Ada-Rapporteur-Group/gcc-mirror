# Copyright (C) 2017 Free Software Foundation, Inc.
#
# This file is part of GCC.
#
# GCC is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3, or (at your option)
# any later version.
#
# GCC is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with GCC; see the file COPYING3.  If not see
# <http://www.gnu.org/licenses/>.

# Enable building IBM extended double multilib on a system that defaults to
# IEEE 128-bit floating point
MULTILIB_OPTIONS	+= mabi=ibmlongdouble/mabi=ieeelongdouble
MULTILIB_DIRNAMES	+= ibm128 ieee128

# Symlink crt{1,i,n}
GCC_PASSES		+= ldbl-crts

# The CRT files don't care whether long double is IBM extended double or IEEE
# 128-bit, so use the same crt*.o files for -mabi=ibmlongdouble and
# -mabi=ieeelongdouble.
#
# Until a GLIBC exists that creates the proper crt{1,i,n}.o for the non-default
# long double format, we need to create versions to build libgcc and libstdc++,
# which use the GCC driver program to build the shared libraries.  If
# crt{1,i,n}.o didn't exist, the shared libraries could not be built.  These
# crt files are used during the compiler build, but they are not installed.
ldbl-crts: xgcc$(exeext)
	for x in ibm128 ieee128; do \
		mkdir -p $$x; \
		for y in crt1.o crti.o crtn.o; do \
			b=`./xgcc$(exeext) -B./ --print-file-name $$y`; \
			if [ x$$b != x$$y ]; then \
				rm -f $$x/$$y; \
				ln -s $$b $$x/$$y; \
				echo "Create $$x/$$y link"; \
			fi; \
		done; \
	done; \
	touch ldbl-crts

